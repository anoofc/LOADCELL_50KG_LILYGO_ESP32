#define DEBUG 1

#include <Arduino.h>
#include <BluetoothSerial.h>
#include "HX711.h" // Include the HX711 library

BluetoothSerial SerialBT; // Create a BluetoothSerial object

// Define the pins for the HX711 module
#define LOADCELL_DOUT_PIN 32 // DT pin connected to Arduino Digital Pin 2
#define LOADCELL_SCK_PIN 13  // SCK pin connected to Arduino Digital Pin 3

HX711 scale; // Create an instance of the HX711 class

float calibration_factor = -7050; // This value needs to be calibrated for your specific load cell and setup

void setup() {
  Serial.begin(115200); // Start serial communication at 9600 baud rate
  Serial.println("HX711 calibration sketch");
  Serial.println("Remove all weight from scale");
  Serial.println("After readings begin, place known weight on scale");
  Serial.println("Press '+' or 'a' to increase calibration factor");
  Serial.println("Press '-' or 'z' to decrease calibration factor");

  scale.begin(LOADCELL_DOUT_PIN, LOADCELL_SCK_PIN); // Initialize the HX711
  scale.set_scale(); // Set the scale to 1 (raw readings)
  scale.tare(); // Reset the scale to 0 (zero out the initial load)

  long zero_factor = scale.read_average(); // Get a baseline reading for tare
  Serial.print("Zero factor: ");
  Serial.println(zero_factor);
}

void loop() {
  scale.set_scale(calibration_factor); // Apply the calibration factor
  
  Serial.print("Reading: ");
  Serial.print(scale.get_units(), 1); // Get the weight in units (e.g., lbs or kg)
  Serial.print(" kg"); // Change "lbs" to "kg" and adjust calibration factor if using SI units
  Serial.print(" calibration_factor: ");
  Serial.print(calibration_factor);
  Serial.println();

  // Adjust calibration factor via serial input
  if (Serial.available()) {
    char temp = Serial.read();
    if (temp == '+' || temp == 'a')
      calibration_factor += 10;
    else if (temp == '-' || temp == 'z')
      calibration_factor -= 10;
  }
}

